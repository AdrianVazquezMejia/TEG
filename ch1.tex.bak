En este capítulo se tratarán los fundamentos del funcionamientos de las redes WiFi malladas, protocolo Modbus y características de sofware y hardware del microcontrolador ESP32. 

\section{Fundamentos de las redes WiFi malladas}

Las redes WiFi malladas (WMN)se pueden definir basicamente como una red que permite la comunicaion entre nodos a traves de saltos multiples en una topologpia mallada \cite{bahr}. Los nodos intermedios pueden reenviar los datos al destino. Las WMN conisiten usualmente de clientes, enrutadores y puertas de enlace. Los clientes son dispositivos electronicos, sistemas enbebidos, y sensores que pueden comunicarse con otros en una red. El enrutador en un dispositivo electronicos que sirve como un intermediario entre dos o mas redes para transportar los datos de una red a otra.  Y las compuertas de enlace es un dispositivo electronico que conecta la red con el Internet. 

Cuando un nodo no puede operar, el resto de los nodos en la WMN aun pueden comunicarse con los otros, bien sea directa o indirectamente a través de uno o mas nodos intermediarios.\citep{ScienceDirect}.

\begin{figure}[H]
\centering
\includegraphics[scale=1]{topologia1.png}\label{Fig1: Topologia Mallada}
\caption{Topología Mallada}
\end{figure}
%imagen de una red mallada.
 
Una red WiFi mallada es  establecida en la banda para comunicación WiFi (sea 2,4 GHz o 5GHz), donde hay estaciones que soportan comunicación de multiples saltos (multi-hop) para transferir información en la red. Así mismo se tiene que, el enrutamiento y la capacidades de reenvios de datos residen en la capa de Control de Acceso al Medio (MAC) \cite{article1}.

\subsection*{La capa de Control de Acceso al Medio (MAC)}

La capa MAC administra el acceso al medio compartido, proyendo sincronización entre diferentes nodos para permitir la transimisión inalambrica. Dicha incronización se convierte cada vez más importante tanto el metodo de acceso es más complejo. Como un ejemplo, sincronización  puede ser necesaria entre nodos de un sistema que emplee el un espectro abierto. Como otro ejemplo, nodos individuales puediesen necesitar permiso de un controlador en una red inalámbrica para transmitir en un canal dado. La capa MAC administra las negociaciones con un nodo de control para el acceso.

Las funciones específicas que estan encapsuladas en la capa MAC, varian de un protocolo a otro. Estas funciones incluyen, pero no estan limitadas a, técnicas de acceso múltiple, sincronización un medio abierto,  y correccción de errores. \nocite{inbook}

\begin{figure}[H]
\centering
\includegraphics[scale=0.4]{mac.png}\label{Fig2: Esquema Mac}
\caption{El propósito de la capa MAC es administrar el medio}
\end{figure}

\subsection*{Dirección MAC}

En una red de computadoras, la dirección Mac es un valor único asociado a un adaptador de red. La dirección MAC también es conocida como dirección de hardware o dirección física.  La dirección MAC trabaja en la segunda capa del modelo OSI, siendo identificada como  com en la capa de vínculo.  

Las direcciones MAC se componen de 12 número hexadecimales (48  bits de longitud). Por convención las direcciones MAC son escritas en una de los dos formatos siguientes:
{\small
\begin{equation}
MM:MM:MM:SS:SS:SS \quad o \quad MM-MM-MM-SS-SS-SS
\end{equation}
}
La primera mitad de la dirección MAC contiene el número identificador del fabricante  del adaptador(i.e 00:A0:C9:14:C8:29). Dichos identificadores por un estadar de Internet. La segunda parte de la dirección MAC representa el número de serial asignado al adaptador por el fabricante. La suplantación de MAC es equivalente a hacerce cargo de los controladores de interfaz de red (NIC). La unicidad de la dirección MAC es esencial en todas la fases de la comunicación de red porque mapea todos los identificadores de las capas superiores \cite{MACen}.

\section{La Referencia del Modelo OSI}

El modelo del sistema de interconxión abierta (OSI) esta basado en una  propuesta del la Organización Internacional de estandares (ISO) para la la estadarización de pilas de protocolos. El modelo consiste en siete (7) capas.

\begin{enumerate}
\item Una caoa debe existir para cada nivel de abstracción.
\item Cada para debe ejecutar una función bien definida.
\item La función de cada capa debe formar parte de un estadar internacional.
\item Los límites de cada capa  deben minimizar el flujo de información a través de las interfaces.
\item El número de capas debe de suficientemente grande para no forzar multiples funciones en una sola capa, pero lo sufientemente pequeña para que la arquitectura no sea incómoda,
\end{enumerate}

Las siete capas del modelo osei, juntas, son solo un modelo de referencia, y no son una arquitectura de red, Los estandar de la ISO existe para varios niveles, y no son parte de este modelo. Las capas son:

\begin{enumerate}
\item La capa de aplicación,
\item La capa de presentación,
\item La coa de seción,
\item La capa de transporte,
\item La capa de red,
\item La capa de vínculo de datos y,
\item La capa física.
\end{enumerate}

Para entender las funcionalidadesd y la interreñación entres estas capas, es beneficioso estudiarlar desde la capa física hacia arriba.

\subsection{La capa Física}

A la capa capa física  le concierne la transmisión de los bits de data cruda sobre el canal de comunicación. Es reponsable por asegurarse de la integridad de dichos bits tanto por la entrega como por la interpretación. Los detalles específicos de cuantos Volts representan el "0" lógico y cuantos representan el "1", la duración de la señal, el mecanismo de conexión y la desconexión, etc., son dependientes de los medios físicos y los dispositivos empleados.

 \subsection{La capa de vínculo de datos}
 
 La capa de vínculo de datos provee la primera capa de abstracción en la pila. Esta proteje la capa de red de detalles de nivel bajo y errores de la capa física. Esto es logrado agrupando los bits crudos en una unidad de nivel más alta llamada trama de datos, la cual puede ser usada en la capa de red.
 
 La trama de datos consiste en un unos cuantos cientos o miles de bytes. Patrones  especiales de bits delimitan la carga, para que la trama de datos sea reconocida. Esto significa que especial cuidado se debe posee para asegurar que estos patrones especiales no ocurren dentro de la carga, en cuyo caso la trama se perdería. Un mecanismo apropiado debe existir para notificar que la fuente retransmite la trama. 
 
Otra característica en esta capa es la inclusión del control de flujo y los agradecimientos. Redes broadcast estan basadas en un canal compartido.  Una subcapa ha sido introducida en la capa de de vínculo de datos para manejar con el control de acceso a canales compartidos, con el nombre de subcapa de control  de acceso al medio.


\subsection{La capa de red}

La capa de red en la responsable por controlar la operación de la subred. La carga de la trama de datos, en esta capa, es llamada paquete. Esta capa determina como mover el paquete desde la fuente al destino usando las rutas apropiadas. La determinación de dichas rutas puede puede ser estático o dinámico. La capa de red tambien maneja la conjestión de la red. 

La capa de red tiene que lidiar con problemas relacionados con las diferentes arquitecturas de red, diferentes direccionamientos, y diferentes condiciones de operación y restricciones, tanto en los sistemas de origen como en los de destino. La heterogeneidad de red es tomada en cuenta en esta capa.

\subsection{La capa de transporte}
 La función básica de la capa de transporte es aceptar datos de un capa más alta, descomponerla en unidades más pequeñas, si es  nececesario, para pasarlas a la capa de red, y asegurarse que estas piezas llegar correctamente al destino. Para propósitos de eficiencia, la capa de trasnporte puede multiplexar varias conexiones de transporte en una sola conexión.
 
 Ña capa de transporte es la primera capa fin-a-fin  de la pila. En las capas más bajas, la intección real no necesitaba estar entre los sistemasa de de fuente y destino. Enrutadores o sistemas intermedios podian ser parte de la transacción. La interacción en esta capa, sin embargo, es siempre entre puntos finales.
 
 El control de flujo juega un rol importante en la capa de transporte (Así como en las otras capas). 
 \subsection{?}
 
 


%
%
%Un ejemplo de tabla es
%
%\begin{table}
%  \centering
%\begin{tabular}{llr}
% \toprule
%\multicolumn{2}{c}{Item} \\
%\cmidrule(r){1-2}
%Animal & Description & Price (\$) \\
%\midrule
%Gnat  & per gram & 13.65 \\
%      & each     &  0.01 \\
%Gnu   & stuffed  & 92.50 \\
%Emu   & stuffed  & 33.33 \\
%Armadillo & frozen & 8.99 \\
%\bottomrule
%\end{tabular}
%
%  \caption{Otra tabla}\label{Tab:otra}
%\end{table}
%
%
%Según \cite{Hvattum200931}
%
%
%\begin{table}
%  \centering
%  \caption{Ejemplo}\label{Tab:producion}
%\begin{tabular}{llr}
%\toprule
%\multicolumn{2}{c}{Item} \\
%\cmidrule(r){1-2}
%Animal & Description & Price (\$) \\
%\midrule
%Gnat  & per gram & 13.65 \\
%      & each     &  0.01 \\
%Gnu   & stuffed  & 92.50 \\
%Emu   & stuffed  & 33.33 \\
%Armadillo & frozen & 8.99 \\
%\bottomrule
%\end{tabular}
%\end{table}
